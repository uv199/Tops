{"version":3,"names":["_v8flags","require","_path","_child_process","_url","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","path","join","dirname","__filename","babelArgs","process","argv","slice","userArgs","argSeparator","indexOf","getNormalizedV8Flag","matches","match","replace","aliases","Map","getV8Flags","v8Flags","i","length","flag","split","push","unshift","allowedNodeEnvironmentFlags","kexec","code","shouldPassthroughIPC","send","proc","child_process","spawn","stdio","on","signal","kill","pid","exitCode","message"],"sources":["../src/babel-node.ts"],"sourcesContent":["/**\n * This tiny wrapper file checks for known node flags and appends them\n * when found, before invoking the \"real\" _babel-node(1) executable.\n */\n\nimport getV8Flags from \"v8flags\";\nimport path from \"path\";\nimport child_process from \"child_process\";\nimport { fileURLToPath } from \"url\";\n\nconst args = [\n  path.join(path.dirname(fileURLToPath(import.meta.url)), \"_babel-node\"),\n];\n\nlet babelArgs = process.argv.slice(2);\nlet userArgs: string[];\n\n// separate node arguments from script arguments\nconst argSeparator = babelArgs.indexOf(\"--\");\nif (argSeparator > -1) {\n  userArgs = babelArgs.slice(argSeparator); // including the  --\n  babelArgs = babelArgs.slice(0, argSeparator);\n}\n\n/**\n * Replace dashes with underscores in the v8Flag name\n * Also ensure that if the arg contains a value (e.g. --arg=true)\n * that only the flag is returned.\n */\nfunction getNormalizedV8Flag(arg: string) {\n  // v8 uses the \"no\" prefix to negate boolean flags (e.g. --nolazy),\n  // but they are not listed by v8flags\n  const matches = arg.match(/--(?:no)?(.+)/);\n\n  if (matches) {\n    return `--${matches[1].replace(/-/g, \"_\")}`;\n  }\n\n  return arg;\n}\n\n// These are aliases for node options defined by babel-node.\nconst aliases = new Map([\n  [\"-d\", \"--debug\"],\n  [\"-gc\", \"--expose-gc\"],\n]);\n\ngetV8Flags(async function (err, v8Flags) {\n  for (let i = 0; i < babelArgs.length; i++) {\n    const arg = babelArgs[i];\n    const flag = arg.split(\"=\")[0];\n\n    if (flag === \"-r\" || flag === \"--require\") {\n      args.push(flag);\n      args.push(babelArgs[++i]);\n    } else if (aliases.has(flag)) {\n      args.unshift(aliases.get(flag));\n    } else if (\n      flag === \"debug\" || // node debug foo.js\n      flag === \"inspect\" ||\n      v8Flags.indexOf(getNormalizedV8Flag(flag)) >= 0 ||\n      process.allowedNodeEnvironmentFlags.has(flag)\n    ) {\n      args.unshift(arg);\n    } else {\n      args.push(arg);\n    }\n  }\n\n  // append arguments passed after --\n  if (argSeparator > -1) {\n    args.push(...userArgs);\n  }\n\n  try {\n    const { default: kexec } = await import(\"kexec\");\n    kexec(process.argv[0], args);\n  } catch (err) {\n    if (\n      err.code !== \"ERR_MODULE_NOT_FOUND\" &&\n      err.code !== \"MODULE_NOT_FOUND\" &&\n      err.code !== \"UNDECLARED_DEPENDENCY\"\n    ) {\n      throw err;\n    }\n\n    // passthrough IPC only if babel-node itself has an IPC channel\n    const shouldPassthroughIPC = process.send !== undefined;\n    const proc = child_process.spawn(process.argv[0], args, {\n      stdio: shouldPassthroughIPC\n        ? [\"inherit\", \"inherit\", \"inherit\", \"ipc\"]\n        : \"inherit\",\n    });\n    proc.on(\"exit\", function (code, signal) {\n      process.on(\"exit\", function () {\n        if (signal) {\n          process.kill(process.pid, signal);\n        } else {\n          process.exitCode = code ?? undefined;\n        }\n      });\n    });\n    if (shouldPassthroughIPC) {\n      proc.on(\"message\", message => process.send(message));\n    }\n    process.on(\"SIGINT\", () => proc.kill(\"SIGINT\"));\n    process.on(\"SIGTERM\", () => proc.kill(\"SIGTERM\"));\n  }\n});\n"],"mappings":";;AAKA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,cAAA,GAAAF,OAAA;AACA,IAAAG,IAAA,GAAAH,OAAA;AAAoC,SAAAI,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAI,wBAAAC,GAAA,EAAAL,WAAA,SAAAA,WAAA,IAAAK,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAT,wBAAA,CAAAC,WAAA,OAAAQ,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAAA,SAAAW,mBAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,EAAAX,GAAA,EAAAY,GAAA,cAAAC,IAAA,GAAAN,GAAA,CAAAP,GAAA,EAAAY,GAAA,OAAAE,KAAA,GAAAD,IAAA,CAAAC,KAAA,WAAAC,KAAA,IAAAN,MAAA,CAAAM,KAAA,iBAAAF,IAAA,CAAAG,IAAA,IAAAR,OAAA,CAAAM,KAAA,YAAAG,OAAA,CAAAT,OAAA,CAAAM,KAAA,EAAAI,IAAA,CAAAR,KAAA,EAAAC,MAAA;AAAA,SAAAQ,kBAAAC,EAAA,6BAAAC,IAAA,SAAAC,IAAA,GAAAC,SAAA,aAAAN,OAAA,WAAAT,OAAA,EAAAC,MAAA,QAAAF,GAAA,GAAAa,EAAA,CAAAI,KAAA,CAAAH,IAAA,EAAAC,IAAA,YAAAZ,MAAAI,KAAA,IAAAR,kBAAA,CAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,UAAAG,KAAA,cAAAH,OAAAc,GAAA,IAAAnB,kBAAA,CAAAC,GAAA,EAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,MAAA,WAAAc,GAAA,KAAAf,KAAA,CAAAgB,SAAA;AAEpC,MAAMJ,IAAI,GAAG,CACXK,KAAI,CAACC,IAAI,CAACD,KAAI,CAACE,OAAO,CAAAC,UAA+B,CAAC,EAAE,aAAa,CAAC,CACvE;AAED,IAAIC,SAAS,GAAGC,OAAO,CAACC,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;AACrC,IAAIC,QAAkB;AAGtB,MAAMC,YAAY,GAAGL,SAAS,CAACM,OAAO,CAAC,IAAI,CAAC;AAC5C,IAAID,YAAY,GAAG,CAAC,CAAC,EAAE;EACrBD,QAAQ,GAAGJ,SAAS,CAACG,KAAK,CAACE,YAAY,CAAC;EACxCL,SAAS,GAAGA,SAAS,CAACG,KAAK,CAAC,CAAC,EAAEE,YAAY,CAAC;AAC9C;AAOA,SAASE,mBAAmBA,CAAC1B,GAAW,EAAE;EAGxC,MAAM2B,OAAO,GAAG3B,GAAG,CAAC4B,KAAK,CAAC,eAAe,CAAC;EAE1C,IAAID,OAAO,EAAE;IACX,OAAQ,KAAIA,OAAO,CAAC,CAAC,CAAC,CAACE,OAAO,CAAC,IAAI,EAAE,GAAG,CAAE,EAAC;EAC7C;EAEA,OAAO7B,GAAG;AACZ;AAGA,MAAM8B,OAAO,GAAG,IAAIC,GAAG,CAAC,CACtB,CAAC,IAAI,EAAE,SAAS,CAAC,EACjB,CAAC,KAAK,EAAE,aAAa,CAAC,CACvB,CAAC;AAEFC,QAAU,CAAAzB,iBAAA,CAAC,WAAgBM,GAAG,EAAEoB,OAAO,EAAE;EACvC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGf,SAAS,CAACgB,MAAM,EAAED,CAAC,EAAE,EAAE;IACzC,MAAMlC,GAAG,GAAGmB,SAAS,CAACe,CAAC,CAAC;IACxB,MAAME,IAAI,GAAGpC,GAAG,CAACqC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAE9B,IAAID,IAAI,KAAK,IAAI,IAAIA,IAAI,KAAK,WAAW,EAAE;MACzC1B,IAAI,CAAC4B,IAAI,CAACF,IAAI,CAAC;MACf1B,IAAI,CAAC4B,IAAI,CAACnB,SAAS,CAAC,EAAEe,CAAC,CAAC,CAAC;IAC3B,CAAC,MAAM,IAAIJ,OAAO,CAACjD,GAAG,CAACuD,IAAI,CAAC,EAAE;MAC5B1B,IAAI,CAAC6B,OAAO,CAACT,OAAO,CAAChD,GAAG,CAACsD,IAAI,CAAC,CAAC;IACjC,CAAC,MAAM,IACLA,IAAI,KAAK,OAAO,IAChBA,IAAI,KAAK,SAAS,IAClBH,OAAO,CAACR,OAAO,CAACC,mBAAmB,CAACU,IAAI,CAAC,CAAC,IAAI,CAAC,IAC/C,CAAAhB,OAAA,CAAAoB,2BAAA,IAAAzE,OAAA,4BAAoCc,GAAG,CAACuD,IAAI,CAAC,EAC7C;MACA1B,IAAI,CAAC6B,OAAO,CAACvC,GAAG,CAAC;IACnB,CAAC,MAAM;MACLU,IAAI,CAAC4B,IAAI,CAACtC,GAAG,CAAC;IAChB;EACF;EAGA,IAAIwB,YAAY,GAAG,CAAC,CAAC,EAAE;IACrBd,IAAI,CAAC4B,IAAI,CAAC,GAAGf,QAAQ,CAAC;EACxB;EAEA,IAAI;IACF,MAAM;MAAE5C,OAAO,EAAE8D;IAAM,CAAC,SAAApC,OAAA,CAAAT,OAAA,GAAAU,IAAA,OAAA9B,uBAAA,CAAAT,OAAA,CAAgB,OAAO,GAAC;IAChD0E,KAAK,CAACrB,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,EAAEX,IAAI,CAAC;EAC9B,CAAC,CAAC,OAAOG,GAAG,EAAE;IACZ,IACEA,GAAG,CAAC6B,IAAI,KAAK,sBAAsB,IACnC7B,GAAG,CAAC6B,IAAI,KAAK,kBAAkB,IAC/B7B,GAAG,CAAC6B,IAAI,KAAK,uBAAuB,EACpC;MACA,MAAM7B,GAAG;IACX;IAGA,MAAM8B,oBAAoB,GAAGvB,OAAO,CAACwB,IAAI,KAAK9B,SAAS;IACvD,MAAM+B,IAAI,GAAGC,cAAa,CAACC,KAAK,CAAC3B,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,EAAEX,IAAI,EAAE;MACtDsC,KAAK,EAAEL,oBAAoB,GACvB,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,KAAK,CAAC,GACxC;IACN,CAAC,CAAC;IACFE,IAAI,CAACI,EAAE,CAAC,MAAM,EAAE,UAAUP,IAAI,EAAEQ,MAAM,EAAE;MACtC9B,OAAO,CAAC6B,EAAE,CAAC,MAAM,EAAE,YAAY;QAC7B,IAAIC,MAAM,EAAE;UACV9B,OAAO,CAAC+B,IAAI,CAAC/B,OAAO,CAACgC,GAAG,EAAEF,MAAM,CAAC;QACnC,CAAC,MAAM;UACL9B,OAAO,CAACiC,QAAQ,GAAGX,IAAI,WAAJA,IAAI,GAAI5B,SAAS;QACtC;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;IACF,IAAI6B,oBAAoB,EAAE;MACxBE,IAAI,CAACI,EAAE,CAAC,SAAS,EAAEK,OAAO,IAAIlC,OAAO,CAACwB,IAAI,CAACU,OAAO,CAAC,CAAC;IACtD;IACAlC,OAAO,CAAC6B,EAAE,CAAC,QAAQ,EAAE,MAAMJ,IAAI,CAACM,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC/C/B,OAAO,CAAC6B,EAAE,CAAC,SAAS,EAAE,MAAMJ,IAAI,CAACM,IAAI,CAAC,SAAS,CAAC,CAAC;EACnD;AACF,CAAC,EAAC"}