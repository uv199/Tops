{"version":3,"names":["_v8flags","require","_path","_child_process","_url","_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","path","join","dirname","__filename","babelArgs","process","argv","slice","userArgs","argSeparator","indexOf","getNormalizedV8Flag","matches","match","replace","getV8Flags","v8Flags","map","allowedNodeEnvironmentFlags","forEach","flag","push","v8FlagsSet","Set","length","split","unshift","kexec","code","shouldPassthroughIPC","send","proc","child_process","spawn","stdio","on","signal","kill","pid","exitCode","message"],"sources":["../src/babel-node.ts"],"sourcesContent":["/**\n * This tiny wrapper file checks for known node flags and appends them\n * when found, before invoking the \"real\" _babel-node(1) executable.\n */\n\nimport getV8Flags from \"v8flags\";\nimport path from \"path\";\nimport child_process from \"child_process\";\nimport { fileURLToPath } from \"url\";\n\nconst args = [\n  path.join(path.dirname(fileURLToPath(import.meta.url)), \"_babel-node\"),\n];\n\nlet babelArgs = process.argv.slice(2);\nlet userArgs: string[];\n\n// separate node arguments from script arguments\nconst argSeparator = babelArgs.indexOf(\"--\");\nif (argSeparator > -1) {\n  userArgs = babelArgs.slice(argSeparator); // including the  --\n  babelArgs = babelArgs.slice(0, argSeparator);\n}\n\n/**\n * Replace underscores with dashes in the v8Flag name\n * Also ensure that if the arg contains a value (e.g. --arg=true)\n * that only the flag is returned.\n */\nfunction getNormalizedV8Flag(arg: string) {\n  // v8 uses the \"no\" prefix to negate boolean flags (e.g. --nolazy),\n  // but they are not listed by v8flags\n  const matches = arg.match(/--(?:no)?(.+)/);\n\n  if (matches) {\n    return `--${matches[1].replace(/_/g, \"-\")}`;\n  }\n\n  return arg;\n}\n\ngetV8Flags(async function (err, v8Flags) {\n  if (!process.env.BABEL_8_BREAKING) {\n    // The version of v8flags used by Babel 7 uses _, while the one used\n    // by Babel 8 used -. Normalize the flags accordingly.\n    v8Flags = v8Flags.map(getNormalizedV8Flag);\n    process.allowedNodeEnvironmentFlags.forEach(flag =>\n      v8Flags.push(getNormalizedV8Flag(flag)),\n    );\n  }\n\n  const v8FlagsSet = new Set(v8Flags);\n\n  for (let i = 0; i < babelArgs.length; i++) {\n    const arg = babelArgs[i];\n    const flag = arg.split(\"=\")[0];\n\n    if (!process.env.BABEL_8_BREAKING) {\n      if (flag === \"-d\") {\n        args.unshift(\"--debug\");\n        continue;\n      } else if (flag === \"-gc\") {\n        args.unshift(\"--expose-gc\");\n        continue;\n      }\n    }\n    if (flag === \"-r\" || flag === \"--require\") {\n      args.push(flag);\n      args.push(babelArgs[++i]);\n    } else if (\n      flag === \"debug\" || // node debug foo.js\n      flag === \"inspect\" ||\n      v8FlagsSet.has(getNormalizedV8Flag(flag))\n    ) {\n      args.unshift(arg);\n    } else {\n      args.push(arg);\n    }\n  }\n\n  // append arguments passed after --\n  if (argSeparator > -1) {\n    args.push(...userArgs);\n  }\n\n  try {\n    // eslint-disable-next-line import/no-unresolved\n    const { default: kexec } = await import(\"kexec\");\n    kexec(process.argv[0], args);\n  } catch (err) {\n    if (\n      err.code !== \"ERR_MODULE_NOT_FOUND\" &&\n      err.code !== \"MODULE_NOT_FOUND\" &&\n      err.code !== \"UNDECLARED_DEPENDENCY\"\n    ) {\n      throw err;\n    }\n\n    // passthrough IPC only if babel-node itself has an IPC channel\n    const shouldPassthroughIPC = process.send !== undefined;\n    const proc = child_process.spawn(process.argv[0], args, {\n      stdio: shouldPassthroughIPC\n        ? [\"inherit\", \"inherit\", \"inherit\", \"ipc\"]\n        : \"inherit\",\n    });\n    proc.on(\"exit\", function (code, signal) {\n      process.on(\"exit\", function () {\n        if (signal) {\n          process.kill(process.pid, signal);\n        } else {\n          process.exitCode = code ?? undefined;\n        }\n      });\n    });\n    if (shouldPassthroughIPC) {\n      proc.on(\"message\", message => process.send(message));\n    }\n    process.on(\"SIGINT\", () => proc.kill(\"SIGINT\"));\n    process.on(\"SIGTERM\", () => proc.kill(\"SIGTERM\"));\n  }\n});\n"],"mappings":"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"}